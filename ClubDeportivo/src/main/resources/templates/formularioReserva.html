<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
        th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/general.css}">
    <script src="" th:src="@{/js/validacionReservas.js}" defer></script>
</head>

<body>
    <header th:replace="~{fragments/encabezado :: encabezado}"></header>
    <main>
        <div id="booking" class="section">
            <div class="section-center">
                <div class="container">
                    <div class="row">
                        <div class="col-md-7 col-md-push-5">
                            <div class="booking-cta">
                                <h1>Haz tu reserva</h1>
                                <p>Haz tu reserva con nosotros
                                </p>
                            </div>
                        </div>
                        <div class="col-md-4 col-md-pull-7">
                            <div class="booking-form mt-md-5">
                                <form method="POST" th:action="@{/reserva-pista/nuevo}" th:object="${reserva}"
                                    id="formularioReserva">
                                    <input type="hidden" th:field="*{socio}" />
                                    <div class="form-group">
                                        <span class="form-label">Deporte</span>
                                        <select class="form-select" id="addDeporte" th:field="*{pista.deporte}"
                                            required>
                                            <option value="">Selecciona un deporte</option>
                                            <option th:each="deporte : ${deportes}" th:value="${deporte.id}"
                                                th:text="${deporte.nombre}"></option>
                                        </select>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <span class="form-label">Fecha</span>
                                                <input class="form-control" id="addFechaReserva" type="date"
                                                    th:field="*{fecha_reserva}" required>
                                                <p class="errorForm">"La fecha seleccionada no es válida. Por favor,
                                                    verifica que no sea un domingo, tampoco se puede hacer una reserva para
                                                    un plazo mayor de 14 días.</p>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group">
                                                <span
                                                    class="form-label">Hora</span><!--Tiene que ir asociado con el horario-->
                                                <input class="form-control" id="addHoraReserva" type="time"
                                                    th:field="*{hora_reserva}" step="3600" min="07:00" max="21:00"
                                                    required>
                                                <p class="errorForm">La hora seleccionada no es válida. Por favor, elige
                                                    una hora que sea al menos 10 minutos mayor que la hora actual.</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-sm-6">
                                            <div class="form-group" style="display: none;" id="pistaContainer">
                                                <span class="form-label" th:disabled="${#lists.isEmpty(pistas)}">Pista</span>
                                                <select id="addPista" class="form-select" th:field="*{pista}" required
                                                    th:disabled="${#lists.isEmpty(pistas)}">
                                                    <option value=""></option>
                                                    <option th:each="pista : ${pistas}" th:value="${pista.id}"
                                                        th:text="${'Pista' + ' - ' + pista.numero}"
                                                        th:data-deporte-id="${pista.deporte.id}" th:data-precio="${pista.precio}"
                                                         th:data-hora_aumento_precio="${pista.hora_aumento_precio}" th:data-aumento_precio="${pista.aumento_precio}">
                                                    </option>></option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-sm-6">
                                            <div class="form-group text-end" style="display: none;" id="precioContainer">
                                                <p class="indicadorPrecio form-label" style="color: red;">Precio: <span id="precioPista"></span></p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="alert alert-warning alert-dismissible fade show" role="alert" th:if="${error}">
                                        <span th:text="${error}"></span>
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                    <div class="form-btn text-center" sec:authorize="hasRole('ROLE_USER')">
                                        <input type="submit" class="submit-btn" value="Reservar">
                                    </div>
                                    <div class="alert alert-danger text-center p-md-1" role="alert"
                                        sec:authorize="hasRole('ROLE_ADMIN')">
                                        ¡Atención! Solo los socios pueden reservar pistas en este sitio.
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>

</html>